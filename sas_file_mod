/*SAS Scripts for use with dc_crime78_07.sas7bdat (Elliot & Woodward, 2015)
*
 * Task code generated by SAS Studio 3.8  
 */
 /Modifying File
DATA NEWCRIME;SET MIS445.dc_crime78_07;
FORMAT TOTAL 6.;
ARRAY INCIDENTS(*) VIOLENT--CARTHEFT;
DO I= LBOUND(INCIDENTS) to HBOUND(INCIDENTS);
	  TOTAL=SUM(of TOTAL,INCIDENTS(i));
END;
DROP I;
TOTALCRIMES=SUM(of INCIDENTS(*));
PCTTOTAL=TOTALCRIMES/POP*100;
RUN;
PROC PRINT DATA=NEWCRIME;
VAR YEAR POP--CARTHEFT TOTAL;
RUN;

TITLE;FOOTNOTE;
/K-means clustering
ods noproctitle;

proc stdize data=WORK.NEWCRIME out=Work._std_ method=range;
	var POP Violent Property Murder Rape Robbery Assault Burglary Larceny CarTheft;
run;

proc fastclus data=Work._std_ maxclusters=3 out=work.Fastclus_scores1;
	var POP Violent Property Murder Rape Robbery Assault Burglary Larceny CarTheft;
run;

proc delete data=Work._std_;
run;

/PCA
ods noproctitle;
ods graphics / imagemap=on;

proc princomp data=WORK.FASTCLUS_SCORES1 plots(only)=(scree) 
		out=work.Princomp_scores1;
	var POP Violent Property Murder Rape Robbery Assault Burglary Larceny CarTheft;
run;

/Scatterplot
ods graphics / reset width=6.4in height=4.8in imagemap;

proc sgplot data=WORK.PRINCOMP_SCORES1;
	title height=14pt "Target Variable Safety";
	scatter x=Prin1 y=Prin2 / group=CLUSTER datalabel=PCTTOTAL 
		datalabelattrs=(size=7);
	xaxis grid display=(nolabel) type=log;
	yaxis grid display=(nolabel) type=log;
run;

ods graphics / reset;
title;
